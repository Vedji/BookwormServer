# Модуль `models/`

## Оглавление
- [Сокращения аттрибутов orm-моделей](#сокращения-аттрибутов-orm-моделей)
- [Перечисления используемые в ORM-модулях](#перечисления-используемые-в-orm-модулях)
  - [Перечисление `RequestStatus`](#перечисление-requeststatus)
  - [Перечисление `SupportRequestTypes`](#перечисление-supportrequesttypes)
  - [Перечисление `AllowedBookFileFormats`](#перечисление-allowedbookfileformats)
  - [Перечисление `AllowedFileFormats`](#перечисление-allowedfileformats)
  - [Перечисление `FileStatus`](#перечисление-filestatus)
  - [Перечисление `LanguageCodes`](#перечисление-languagecodes)
  - [Перечисление `PasswordEncryptionTypes`](#перечисление-passwordencryptiontypes)
  - [Перечисление `UserPersonalListType`](#перечисление-userpersonallisttype)
  - [Перечисление `S3ACL`](#перечисление-s3acl)
  - [Перечисление `UserRoleDB`](#перечисление-userroledb)
  - [Перечисление `UserRole`](#перечисление-userrole)
- [Описание ORM-моделей](#описание-orm-моделей)
  - [ORM-модель `File`](#orm-модель-file)
  - [ORM-модель `Language`](#orm-модель-language)
  - [Модуль `book/`](#модуль-book)
    - [ORM-модель `Book`](#orm-модель-book)
    - [ORM-модель `BookPreviewImage`](#orm-модель-bookpreviewimage)
    - [ORM-модель `BookTranslation`](#orm-модель-booktranslation)
    - [Модуль `forums/`](#модуль-forums)
      - [ORM-модель `BookForumAnswers`](#orm-модель-bookforumanswers)
      - [ORM-модель `BookForumQuestions`](#orm-модель-bookforumquestions)
    - [Модуль `genres/`](#модуль-genres)
      - [ORM-модель `BookGenre`](#orm-модель-bookgenre)
      - [ORM-модель `Genre`](#orm-модель-genre)
      - [ORM-модель `GenreTranslation`](#orm-модель-genretranslation)
  - [Модуль `reviews/`](#модуль-reviews)
    - [ORM-модель `BookComment`](#orm-модель-bookcomment)
    - [ORM-модель `BookRating`](#orm-модель-bookrating)
  - [Модуль `supports/`](#модуль-supports)
    - [ORM-модель `SupportRequest`](#orm-модель-supportrequest)
    - [ORM-модель `RequestsToGetRoleAuthor`](#orm-модель-requeststogetroleauthor)
    - [ORM-модель `RequestsToGetRolePublisher`](#orm-модель-requeststogetrolepublisher)
  - [Модуль `users/`](#модуль-users)
    - [ORM-модель `User`](#orm-модель-user)
    - [ORM-модель `UserCredentials`](#orm-модель-usercredentials)
    - [ORM-модель `UserDetails`](#orm-модель-userdetails)
    - [ORM-модель `UserLoginAttempts`](#orm-модель-userloginattempts)
    - [Модуль `profile/`](#модуль-profile)
      - [Модуль `bookmarks/`](#модуль-bookmarks)
        - [ORM-модель `UserBookmark`](#orm-модель-userbookmark)
        - [ORM-модель `BookmarkEPUB`](#orm-модель-bookmarkepub)
        - [ORM-модель `BookmarkFB2`](#orm-модель-bookmarkfb2)
      - [Модуль `personal_lists/`](#модуль-personal_lists)
        - [ORM-модель `UserPersonalList`](#orm-модель-userpersonallist)
        - [ORM-модель `UserPersonalListItem`](#orm-модель-userpersonallistitem)
    - [Модуль `roles/`](#модуль-roles)
      - [Модуль `author/`](#модуль-author)
        - [ORM-модель `Authors`](#orm-модель-authors)
        - [ORM-модель `AuthorCurators`](#orm-модель-authorcurators)
        - [ORM-модель `BookAuthors`](#orm-модель-bookauthors)
      - [Модуль `publisher/`](#модуль-publisher)
        - [ORM-модель `Publishers`](#orm-модель-publishers)
        - [ORM-модель `PublisherCurators`](#orm-модель-publishercurators)
        - [ORM-модель `BookPublishers`](#orm-модель-bookpublishers)

## Сокращения аттрибутов orm-моделей
| Полное название |  Сокращенное название  | Описание                                                                        | Примечание                                                          |
|:---------------:|:----------------------:|:--------------------------------------------------------------------------------|:--------------------------------------------------------------------|
|   Primary key   |           PK           | Уникальный идентификатор записи в таблице.                                      | Обязателен для каждой таблицы, не может быть NULL.                  |
|  Autoincrement  |           AI           | Автоматическое увеличение значения при добавлении новой записи.                 | Используется для уникальных идентификаторов, часто с типом INTEGER. |
|   Foreign key   |  FK("{table.column}")  | Ссылается на ключ в другой таблице.                                             | Для установления связи между таблицами.                             |
|    Not Null     |           NN           | Ограничение, запрещающее хранение NULL в столбце.                               | Обязательно указывать, если в поле не могут быть NULL-значения.     |
|      Null       |           N            | Позволяет хранить NULL-значения в столбце.                                      | Используется, если значение в столбце может быть неопределенным.    |
|     Default     |   DEFAULT("{value}")   | Значение по умолчанию для столбца, если не указано иное.                        | Может быть использовано для установки значений по умолчанию.        |
|     Unique      |         UNIQUE         | Ограничение, которое гарантирует, что все значения в столбце будут уникальными. | Используется для обеспечения уникальности значений в столбце.       |
|      Check      | CHECK("{conditional}") | Ограничение для проверки значений в столбце на соответствие условию.            | Может быть использовано для проверки диапазонов или других условий. |


## Перечисления используемые в ORM-модулях
Все перечисления описанные ниже, импортируются из модуля 
[`schemas.constants`](../schemas/constants).

### [Перечисление `RequestStatus`](../schemas/constants/ticket_attributes/request_status.py)

Используется для явного указания текущего состояния пользовательской заявки в системе.

| Значение     | Описание                                           |
|--------------|----------------------------------------------------|
| `pending`    | Заявка отправлена и ожидает рассмотрения.          |
| `approved`   | Заявка рассмотрена и одобрена.                     |
| `rejected`   | Заявка рассмотрена, но отклонена.                  |

---
### [Перечисление `SupportRequestTypes`](../schemas/constants/ticket_attributes/support_request_types.py)

Используется для обозначения типа пользовательской заявки в системе поддержки.

| Значение                            | Описание                                             |
|-------------------------------------|------------------------------------------------------|
| `request_type_none`                 | Тип заявки не указан.                                |
| `request_about_error`               | Сообщение об ошибке в работе системы.                |
| `request_to_get_author_role`        | Заявка на получение роли автора контента.            |
| `request_to_get_publisher_role`     | Заявка на получение роли представителя издательства. |
| `request_to_get_administrator_role` | Заявка на получение роли администратора системы.     |

---
### [Перечисление `AllowedBookFileFormats`](../schemas/constants/allowed_book_file_formats.py)

Используется для указания допустимых MIME-типов файлов, применяемых для хранения содержимого книг в системе.

| Значение                        | Описание                                                         |
|---------------------------------|------------------------------------------------------------------|
| `None`                          | Формат не указан или не применим.                                |
| `application/x-fictionbook+xml` | Формат FictionBook (FB2), распространённый для электронных книг. |
| `application/epub+zip`          | Формат EPUB, стандартный формат электронных книг.                |
| `text/markdown`                 | Текстовый формат Markdown.                                       |

---
### [Перечисление `AllowedFileFormats`](../schemas/constants/allowed_file_formats.py)

Используется для определения допустимых форматов файлов, поддерживаемых системой.

| Значение                        | Описание                                       |
|---------------------------------|------------------------------------------------|
| `application/x-fictionbook+xml` | Формат электронной книги FictionBook (FB2).    |
| `application/epub+zip`          | Формат электронной книги EPUB.                 |
| `application/pdf`               | Документ в формате PDF.                        |
| `text/markdown`                 | Текстовый документ в формате Markdown.         |
| `image/png`                     | Изображение в формате PNG.                     |
| `image/jpeg`                    | Изображение в формате JPEG.                    |
| `image/gif`                     | Анимированное или статическое изображение GIF. |
| `application/zip`               | Архив ZIP.                                     |
| `text/plain`                    | Простой текстовый файл (TXT).                  |
| `application/octet-stream`      | Недопустимый или неизвестный формат файла.     |

---
### [Перечисление `FileStatus`](../schemas/constants/file_status.py)

Используется для указания текущего состояния файла в системе.

| Значение     | Описание                                                  |
|--------------|-----------------------------------------------------------|
| `active`     | Файл активен и доступен для использования.                |
| `expired`    | Срок действия файла истёк, он более недоступен.           |
| `deleted`    | Файл был удалён и более не доступен пользователю.         |
| `local`      | Файл хранится локально и ещё не был загружен в систему.   |

---
### [Перечисление `LanguageCodes`](../schemas/constants/language_codes.py)

Используется для указания кода языка в системе, например, для локализации интерфейса или определения языка контента.

| Значение     | Описание                                     |
|--------------|----------------------------------------------|
| `UNDEFINED`  | Язык не определён.                           |
| `RU`         | Русский язык.                                |
| `EN`         | Английский язык.                             |

---
### [Перечисление `PasswordEncryptionTypes`](../schemas/constants/password_encryption_types.py)

Используется для указания типа шифрования пароля, применяемого в системе безопасности.

| Значение | Описание                                                                                                    |
|----------|-------------------------------------------------------------------------------------------------------------|
| `none`   | Пароль не шифруется. Используется крайне редко и не рекомендуется.                                          |
| `sha256` | Пароль хэшируется с использованием алгоритма SHA-256.                                                       |
| `bcrypt` | Пароль хэшируется с использованием алгоритма bcrypt — одного из самых безопасных методов на текущий момент. |

---
### [Перечисление `UserPersonalListType`](../schemas/constants/personal_list_types.py)

Используется для указания типа личного списка пользователя.

| Значение    | Описание                                      |
|-------------|-----------------------------------------------|
| `DEFAULT`   | Стандартный личный список пользователя.       |
| `CREATED`   | Личный список, созданный пользователем.       |

---
### [Перечисление `S3ACL`](../schemas/constants/s3_acl.py)

Используется для указания уровня доступа к объектам в хранилище S3.

| Значение                    | Описание                                                                     |
|-----------------------------|------------------------------------------------------------------------------|
| `private`                   | Доступ только для владельца объекта.                                         |
| `public-read`               | Объект доступен для чтения всеми пользователями, но только для чтения.       |
| `public-read-write`         | Объект доступен для чтения и записи всеми пользователями.                    |
| `authenticated-read`        | Объект доступен для чтения только для аутентифицированных пользователей.     |
| `bucket-owner-read`         | Доступ на чтение для владельца бакета, независимо от прав владельца объекта. |
| `bucket-owner-full-control` | Полный доступ для владельца бакета, включая права на запись и удаление.      |

---
### [Перечисление `UserRoleDB`](../schemas/constants/user_role.py)

Используется для указания ролей пользователя в базе данных, связанных с управлением книгами или модерацией.

| Значение        | Описание                              |
|-----------------|---------------------------------------|
| `USER`          | Просто авторизированный пользователь. |
| `AUTHOR`        | Автор книг.                           |
| `PUBLISHER`     | Издатель книг.                        |
| `ADMINISTRATOR` | Администратор.                        |

---
### [Перечисление `UserRole`](../schemas/constants/user_role.py)

Используется для указания ролей пользователя в системе с возможностью гостевой роли.

| Значение        | Описание                                 |
|-----------------|------------------------------------------|
| `GUEST`         | Гость, не авторизированный пользователь. |
| `USER`          | Просто авторизированный пользователь.    |
| `AUTHOR`        | Автор книг.                              |
| `PUBLISHER`     | Издатель книг.                           |
| `ADMINISTRATOR` | Администратор.                           |

---


## Описание ORM-моделей

### [ORM-модель `File`](files.py)
**Описание**  

Модель представляет файл, загруженный в систему, с информацией о нем и его состоянии.

**Поля**



|    Поле     |                             Тип                              |                  Аттрибуты                  |                       Описание                       |
|:-----------:|:------------------------------------------------------------:|:-------------------------------------------:|:----------------------------------------------------:|
|   file_id   |                             int                              |                 PK, AI, NN                  |     Уникальный идентификатор файла в базе данных     |
|  file_key   |                             str                              |                 UNIQUE, NN                  | Ключ файла в формате S3 (`{file_path}/{file_name}`)  |
|  mime_type  | Enum[(AllowedFileFormats)](#перечисление-allowedfileformats) |    DEFAULT("INCORRECT_FILE_FORMAT"), NN     | Mime-тип файла (например, изображение, текст и т.д.) |
|   status    |         Enum[(FileStatus)](#перечисление-filestatus)         |            DEFAULT("ACTIVE"), N             |    Статус файла (например, активен или неактивен)    |
| bucket_name |                             str                              |                      N                      |          Имя бакета в S3, где хранится файл          |
|   s3_url    |                             str                              |                      N                      |              Прямая ссылка на файл в S3              |
| expires_at  |                           datetime                           |                      N                      |       Время окончания действия ссылки на файл        |
| uploaded_at |                           datetime                           |    DEFAULT(datetime.datetime.now()), NN     |            Время загрузки файла на сервер            |
| added_user  |                             int                              | FK("users.user_id"), N, ondelete="SET NULL" |        ID пользователя, который загрузил файл        |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, который добавил файл в систему.  
- [**`user_details`**](#orm-модель-userdetails): связь с деталями профиля пользователя, например, если файл является изображением профиля.  
- [**`books`**](#orm-модель-book): указывает на книги, к которым этот файл может быть привязан.  
- [**`book_preview_image_list`**](#orm-модель-bookpreviewimage): указывает на превью изображения для книги, если файл является таким изображением.

---

### [ORM-модель `Language`](languages.py)
**Описание**

Модель представляет язык, используемый в системе. Она хранит языковые коды и соответствующие им названия языков. 

**Поля**

|     Поле      |                        Тип                         |   Аттрибуты    |                          Описание                          |
|:-------------:|:--------------------------------------------------:|:--------------:|:----------------------------------------------------------:|
| language_code | Enum[(LanguageCodes)](#перечисление-languagecodes) | PK, NN, UNIQUE | Код языка, идентификатор языка в БД (например, 'en', 'ru') |
| language_name |                       String                       |       NN       |      Название языка (например, "English", "Русский")       |

**Связи**
- [**`book_translations`**](#orm-модель-booktranslation): указывает на переводы книг на этот язык.  
- [**`genre_translations`**](#orm-модель-genretranslation): указывает на переводы жанров на этот язык.  
- [**`book_comments`**](#orm-модель-bookcomment): указывает на комментарии к книгам, написанные на этом языке.  

---


### [Модуль `book/`](books)
Модуль `book` объединяет orm-модели и модули связанные с книгами. 
Он включает в себя модули, описывающие форум в формате вопрос - ответы, жанры книг, 
а также orm-модели, которые содержат информацию о самих книгах, 
их превью-изображения, переводы названий и описаний для этих книг.

---

##### [ORM-модель `Book`](books/book.py)
**Описание**  

Модель представляет собой основную сущность книги в системе. 
Содержит информацию о дате публикации, формате файла, ISBN, а также связи с автором, 
издателем, комментариями, рейтингами и другой информацией связанной с книгами.

**Поля**

|         Поле          |                                 Тип                                  |           Атрибуты            |                       Описание                        |
|:---------------------:|:--------------------------------------------------------------------:|:-----------------------------:|:-----------------------------------------------------:|
|        book_id        |                                 int                                  |          PK, AI, NN           |            Уникальный идентификатор книги             |
| book_publication_date |                               datetime                               |               N               |                 Дата публикации книги                 |
|     book_content      |                                 int                                  |    FK("files.file_id"), N     |              ID файла с содержимым книги              |
|   book_content_type   | Enum[(AllowedBookFileFormats)](#перечисление-allowedbookfileformats) |              NN               | Формат содержимого книги (например, EPUB, FB2 и т.д.) |
|       book_isbn       |                             str (до 14)                              |               N               |            ISBN код книги без разделителей            |
|      added_user       |                                 int                                  |    FK("users.user_id"), N     |          ID пользователя, добавившего книгу           |
|      updated_at       |                               datetime                               | NN, server_default=func.now() |              Дата последнего обновления               |
|      created_at       |                               datetime                               | NN, server_default=func.now() |             Дата создания записи о книге              |

**Связи**
- [**`user`**](#orm-модель-user) — пользователь, добавивший книгу.  
- [**`content`**](#orm-модель-file) — файл, содержащий контент книги.  
- [**`preview_images`**](#orm-модель-bookpreviewimage) — список изображений предварительного просмотра книги.  
- [**`book_translations`**](#orm-модель-booktranslation) — список переводов книги.  
- [**`book_genres`**](#orm-модель-bookgenre) — список жанров, к которым относится книга.  
- [**`book_ratings`**](#orm-модель-bookrating) — рейтинги, поставленные книге.  
- [**`book_comments`**](#orm-модель-bookcomment) — комментарии к книге.  
- [**`user_personal_list_items`**](#orm-модель-userpersonallistitem) — связь с пользовательскими списками.  
- [**`user_bookmarks`**](#orm-модель-userbookmark) — закладки пользователя в этой книге.  
- [**`publisher`**](#orm-модель-bookpublishers) — издатель книги.  
- [**`author`**](#orm-модель-bookauthors) — автор книги.  
- [**`book_forum_questions`**](#orm-модель-bookforumquestions) — список вопросов к книге на форуме в формате "Вопрос-ответы".

---

##### [ORM-модель `BookPreviewImage`](books/book_preview_images.py)
**Описание**  

Модель представляет список всех, когда-либо добавленных к книге превью-изображений.  

**Поля**


|        Поле         |     Тип     |                    Атрибуты                     |                       Описание                       |
|:-------------------:|:-----------:|:-----------------------------------------------:|:----------------------------------------------------:|
|       book_id       |     int     |           FK("books.book_id"), PK, NN           | Идентификатор книги, к которой относится изображение |
|       file_id       |     int     |           FK("files.file_id"), PK, NN           |           Идентификатор файла изображения            |
| content_description | String(128) | N, DEFAULT("Описание изображения отсутствует.") |             Краткое описание изображения             |
|     created_at      |  datetime   |             NN, DEFAULT(func.now())             |    Дата и время добавления изображения в систему     |

**Связи**

- [**`for_book`**](#orm-модель-book): указывает на книгу, к которой прикреплено изображение.  
- [**`preview_content`**](#orm-модель-file): указывает на файл изображения, связанный с книгой.

---

##### [ORM-модель `BookTranslation`](books/book_translations.py)
**Описание**  

Модель представляет перевод книги на разные языки. Используется для хранения локализованных названий и описаний книги.

**Поля**

|       Поле       |     Тип     |               Атрибуты                |            Описание            |
|:----------------:|:-----------:|:-------------------------------------:|:------------------------------:|
|     book_id      |     int     |      FK("books.book_id"), PK, NN      | Идентификатор связанной книги  |
|  language_code   |     str     | FK("languages.language_code"), PK, NN |       Код языка перевода       |
|    book_title    | String(256) |                  NN                   | Название книги на данном языке |
| book_description |     str     |                   N                   | Описание книги на данном языке |


**Связи**

- [**`book`**](#orm-модель-book): указывает на книгу, к которой относится данный перевод.  
- [**`language`**](#orm-модель-language): указывает на язык, на который выполнен перевод.

---
#### [Модуль `forums/`](books/forums)
Модуль `forums` отвечает за форум в формате "вопрос-ответы" для книг.

---
##### [ORM-модель `BookForumAnswers`](books/forums/book_forum_answers.py)
**Описание**

Модель представляет ответ пользователя на вопрос на форуме книги. Используется для хранения сообщений, 
которые являются ответами на главный заданный вопрос.

**Поля**

|    Поле    |   Тип    |                Атрибуты                 |                   Описание                   |
|:----------:|:--------:|:---------------------------------------:|:--------------------------------------------:|
| answer_id  |   int    |               PK, AI, NN                |       Уникальный идентификатор ответа        |
|  forum_id  |   int    | FK("book_forum_questions.forum_id"), NN | Ссылка на вопрос, к которому относится ответ |
|  message   |   str    |                   NN                    |                 Текст ответа                 |
| added_user |   int    |         FK("users.user_id"), NN         |        Пользователь, написавший ответ        |
| created_at | datetime |      NN, server_default=func.now()      |        Дата и время публикации ответа        |

**Связи**
- [**`question`**](#orm-модель-bookforumquestions): главный вопрос, к которому относиться ответ.
- [**`user`**](#orm-модель-user): указывает на пользователя, который оставил ответ на главный вопрос.
---

##### [ORM-модель `BookForumQuestions`](books/forums/book_forum_questions.py)
**Описание**

Модель представляет главный вопрос, заданный пользователем на форуме книги. 
Используется для организации обсуждений книг в формате "вопрос — ответы".

**Поля**

|       Поле       |     Тип     |        Атрибуты         |                Описание                 |
|:----------------:|:-----------:|:-----------------------:|:---------------------------------------:|
|     forum_id     |     int     |       PK, AI, NN        | Уникальный идентификатор вопроса форума |
|     book_id      |     int     | FK("books.book_id"), NN | Ссылка на книгу, к которой задан вопрос |
|     is_open      |    bool     |    NN, DEFAULT(True)    | Статус обсуждения: открыто или закрыто  |
|      title       | String(256) |           NN            |            Заголовок вопроса            |
| question_message |     str     |            N            |  Содержимое самого вопроса (если есть)  |
|    added_user    |     int     | FK("users.user_id"), NN |   Пользователь, создавший этот вопрос   |
|    created_at    |  datetime   | DEFAULT(func.now()), NN |      Дата и время создания вопроса      |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, который создал вопрос.
- [**`book`**](#orm-модель-book): указывает на книгу, к которой относится обсуждение.
- [**`answers`**](#orm-модель-bookforumanswers): список ответов на заданный вопрос.
---

#### [Модуль `genres/`](books/genres)
Модуль `genres` отвечает за жанры книг, их связи с книгами, а также переводы этих жанров.

---
##### [ORM-модель `BookGenre`](books/genres/book_genres.py)
**Описание**  

Модель представляет таблицу ассоциаций между книгами и жанрами.

**Поля**


|   Поле   | Тип |           Аттрибуты           |      Описание       |
|:--------:|:---:|:-----------------------------:|:-------------------:|
| book_id  | int |  FK("books.book_id"), PK, NN  | Идентификатор книги |
| genre_id | int | FK("genres.genre_id"), PK, NN | Идентификатор жанра |

**Связи**

- [**`book`**](#orm-модель-book): указывает на книгу, относящуюся к жанру.  
- [**`genre`**](#orm-модель-genre): указывает на жанр, к которому относится книга.

---

##### [ORM-модель `Genre`](books/genres/genres.py)
**Описание**  

Модель представляет базовую сущность жанра книги, хранящую только уникальный идентификатор жанра.

**Поля**

|   Поле   | Тип |  Атрибуты  |            Описание            |
|:--------:|:---:|:----------:|:------------------------------:|
| genre_id | int | PK, AI, NN | Уникальный идентификатор жанра |

**Связи**

- [**`genre_translations`**](#orm-модель-genretranslation): содержит список переводов названий жанра.  
- [**`book_genres`**](#orm-модель-bookgenre): список книг, относящихся к этому жанру (через промежуточную таблицу).

---

##### [ORM-модель `GenreTranslation`](books/genres/genres_translations.py)
**Описание**  

Модель представляет переведённые названия жанров.  
Используется для отображения жанров книг на разных языках.

**Поля**

|     Поле      |                        Тип                         |               Аттрибуты               |                    Описание                     |
|:-------------:|:--------------------------------------------------:|:-------------------------------------:|:-----------------------------------------------:|
|   genre_id    |                        int                         |     FK("genres.genre_id"), PK, NN     |  Ссылка на жанр, которому принадлежит перевод   |
| language_code | Enum[(LanguageCodes)](#перечисление-languagecodes) | FK("languages.language_code"), PK, NN | Код языка, на котором представлен перевод жанра |
|  genre_name   |                    String(255)                     |                  NN                   |     Название жанра на соответствующем языке     |

**Связи**

- [**`genre`**](#orm-модель-genre): указывает на оригинальный жанр, к которому относится перевод.  
- [**`language`**](#orm-модель-language): указывает на язык, на котором представлено название жанра.

---

### [Модуль `reviews/`](reviews)
Модуль `reviews` отвечает за представление данных о пользовательских комментариях и оценках к книгам.

#### [ORM-модель `BookComment`](reviews/book_comments.py)
**Описание**  

Модель представляет собой таблицу для хранения пользовательских комментариев к книгам. 
Она позволяет пользователям оставлять отзывы о книгах, а также поддерживает сортировку 
комментариев с помощью языковых кодов.

**Поля**

|     Поле      |                        Тип                         |                       Атрибуты                        |                              Описание                              |
|:-------------:|:--------------------------------------------------:|:-----------------------------------------------------:|:------------------------------------------------------------------:|
|    user_id    |                        int                         |              FK("users.user_id"), PK, NN              |        Идентификатор пользователя, оставившего комментарий         |
|    book_id    |                        int                         |              FK("books.book_id"), PK, NN              |        Идентификатор книги, к которой относится комментарий        |
| language_code | Enum[(LanguageCodes)](#перечисление-languagecodes) | FK("languages.language_code"), DEFAULT(UNDEFINED), NN | Код языка, для локализации комментария. По умолчанию - `UNDEFINED` |
|    message    |                        str                         |                          NN                           |                       Содержимое комментария                       |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, оставившего комментарий.  
- [**`book`**](#orm-модель-book): указывает на книгу, к которой относится комментарий.  
- [**`language`**](#orm-модель-language): указывает на язык, на котором написан комментарий.

---
#### [ORM-модель `BookRating`](reviews/book_ratings.py)
**Описание**  

Модель представляет пользовательские оценки книг. 
Используется для хранения оценок, которые пользователи ставят книгам.

**Поля**

|    Поле    |   Тип    |           Атрибуты            |                      Описание                       |
|:----------:|:--------:|:-----------------------------:|:---------------------------------------------------:|
|  user_id   |   int    |  FK("users.user_id"), PK, NN  | Идентификатор пользователя, который поставил оценку |
|  book_id   |   int    |  FK("books.book_id"), PK, NN  | Идентификатор книги, для которой поставлена оценка  |
|   rating   |   int    |        NN, DEFAULT(0)         |      Оценка книги от пользователя (от 0 до 5)       |
| created_at | datetime | NN, server_default=func.now() |     Дата и время, когда была поставлена оценка      | 

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, поставившего оценку для книги.
- [**`book`**](#orm-модель-book): указывает на книгу, для которой была поставлена оценка.

---
### [Модуль `supports/`](supports)
Этот модуль отвечает за тикеты в техническую поддержку, а также заявки на становление автором или издателем контента.

#### [ORM-модель `SupportRequest`](supports/support_requests.py)
**Описание**  

Модель представляет общие заявки пользователей на поддержку.
Каждая заявка включает в себя информацию о пользователе, статусе, типе запроса и 
возможном ответе модератора.

**Поля**

|         Поле         |                              Тип                               |               Атрибуты                |                      Описание                      |
|:--------------------:|:--------------------------------------------------------------:|:-------------------------------------:|:--------------------------------------------------:|
|      ticket_id       |                              int                               |              PK, AI, NN               |          Уникальный идентификатор заявки           |
| support_request_type | Enum[(SupportRequestTypes)](#перечисление-supportrequesttypes) |        NN, DEFAULT("PENDING")         |       Тип запроса (например, запрос на роль)       |
|        status        |       Enum[(RequestStatus)](#перечисление-requeststatus)       |        NN, DEFAULT("PENDING")         |  Текущий статус заявки (например, ожидает ответа)  |
|     reviewed_at      |                            datetime                            |           N, DEFAULT(None)            |             Время рассмотрения заявки              |
|       subject        |                              str                               |            String(255), NN            |                    Тема запроса                    |
|       message        |                              str                               |                   N                   |                 Сообщение в заявке                 |
|       user_id        |                              int                               |        FK("users.user_id"), NN        | Идентификатор пользователя, который оставил заявку |
|  moderator_comment   |                              str                               |                   N                   |             Ответ модератора на заявку             |
|   reviewed_user_id   |                              int                               | FK("users.user_id"), N, DEFAULT(None) |  Идентификатор модератора, рассмотревшего заявку   |

**Связи**

- **`created_by`**: связь с ORM-моделью [User]. Указывает на пользователя, который создал заявку.  
- **`reviewed_by`**: связь с ORM-моделью [User]. Указывает на администратора, который рассмотрел заявку.  
- **`author_request`**: связь с ORM-моделью [RequestsToGetRoleAuthor]. Указывает на запрос пользователя на роль автора.  
- **`publisher_request`**: связь с ORM-моделью [RequestsToGetRolePublisher]. Указывает на запрос пользователя на роль издателя.

---

#### [ORM-модель `RequestsToGetRoleAuthor`](supports/requests_to_get_role_author.py)
**Описание**  

Модель представляет дополнительную информацию для запроса на получение роли автора контента.

**Поля**

|     Поле      |   Тип    |                 Атрибуты                 |                      Описание                      |
|:-------------:|:--------:|:----------------------------------------:|:--------------------------------------------------:|
|   ticked_id   |   int    | FK("support_requests.ticked_id"), PK, NN |     Идентификатор заявки в систему поддержки.      |
|  first_name   |   str    |                    NN                    |         Имя автора, который подает запрос.         |
|   last_name   |   str    |                    NN                    |                  Фамилия автора.                   |
| contact_email |   str    |                    NN                    |               Почтовый адрес автора.               |
|    website    |   str    |                    N                     | Ссылка на персональный сайт автора (если имеется). |
|   birthday    | datetime |                    N                     |               Дата рождения автора.                |
|  nationality  |   str    |                    N                     |              Страна рождения автора.               |
|  description  |   str    |                    N                     |         Описание автора (пара слов о нем).         |

**Связи**

- [**`base_ticked`**](#orm-модель-supportrequest): указывает на соответствующую заявку в системе поддержки, 
через которую автор подает запрос на получение роли.

---

##### [ORM-модель `RequestsToGetRolePublisher`](supports/requests_to_get_role_publisher.py)
**Описание**  

Модель представляет заявку пользователя на получение роли издателя контента.
Содержит данные об издательстве и контактной информации, предоставленные пользователем.

**Поля**

|      Поле      |     Тип      |                 Атрибуты                 |              Описание               |
|:--------------:|:------------:|:----------------------------------------:|:-----------------------------------:|
|   ticked_id    |     int      | FK("support_requests.ticked_id"), PK, NN |    Ссылка на заявку в поддержку     |
| publisher_name | String(255)  |                    NN                    |        Название издательства        |
|    website     | String(1025) |                    N                     | Веб-сайт издательства (если указан) |
| contact_email  | String(255)  |                    NN                    |    Контактный email издательства    |
| contact_phone  |  String(50)  |                    NN                    |   Контактный телефон издательства   |
|  founded_year  |   datetime   |                    NN                    |     Дата основания издательства     |
|  description   |     str      |                    NN                    |        Описание издательства        |

**Связи**

- [**`base_ticked`**](#orm-модель-supportrequest): связь с ORM-моделью [SupportRequest]. Указывает на связанную заявку в поддержку, на основании которой создаётся запрос на роль издателя.

---

### [Модуль `users/`](users)
Модуль `users` объединяет orm-модели, которые описывают пользователя в системе.

---
#### [ORM-модель `User`](users/user.py)
**Описание**  

Модель представляет пользователя системы.

**Поля**

|    Поле    |                      Тип                       |          Аттрибуты          |                                  Описание                                   |
|:----------:|:----------------------------------------------:|:---------------------------:|:---------------------------------------------------------------------------:|
|  user_id   |                      int                       |         PK, AI, NN          |                    Уникальный идентификатор пользователя                    |
|  username  |                      str                       |         UNIQUE, NN          |                            Никнейм пользователя                             |
|    role    | Enum[("UserRoleDB")](#перечисление-userroledb) |      DEFAULT(USER), NN      | Роль пользователя в системе (например, обычный пользователь, администратор) |
| created_at |                    datetime                    | DEFAULT(datetime.now()), NN |                    Дата и время регистрации пользователя                    |

**Связи**

- [**`credentials`**](#orm-модель-usercredentials): содержит данные для авторизации пользователя.
- [**`files`**](#orm-модель-file): список файлов, добавленных пользователем.
- [**`details`**](#orm-модель-userdetails): содержит детальное описание профиля пользователя.
- [**`added_books`**](#orm-модель-book): список книг, добавленных пользователем.
- [**`book_ratings`**](#orm-модель-bookrating): список оценок книг, оставленных пользователем.
- [**`book_comments`**](#orm-модель-bookcomment): список комментариев пользователя к книгам.
- [**`user_personal_list`**](#orm-модель-userpersonallist): персональные списки, созданные пользователем.
- [**`user_bookmarks`**](#orm-модель-userbookmark): закладки пользователя.
- [**`submitted_tickets`**](#orm-модель-supportrequest): список заявок в техническую поддержку, созданных пользователем.
- [**`reviewed_tickets`**](#orm-модель-supportrequest): заявки, обработанные пользователем.
- [**`publisher_curator`**](#orm-модель-publishercurators): издательство, которое может курировать пользователь.
- [**`author_curator`**](#orm-модель-authorcurators): аккаунт автора, который может курировать пользователь.
- [**`book_forum_questions`**](#orm-модель-bookforumquestions): вопросы, заданные пользователем на форуме книг.
- [**`book_forum_answers`**](#orm-модель-bookforumanswers): ответы пользователя на вопросы форума книг.
- [**`user_login_attempt`**](#orm-модель-userloginattempts): список попыток входа в аккаунт пользователя.

---

#### [ORM-модель `UserCredentials`](users/user_credentials.py)
**Описание**  

Модель представляет учетные данные пользователя.

**Поля**

|        Поле         |                                   Тип                                    |          Атрибуты           |                               Описание                               |
|:-------------------:|:------------------------------------------------------------------------:|:---------------------------:|:--------------------------------------------------------------------:|
|       user_id       |                                   int                                    | FK("users.user_id"), PK, NN |       Идентификатор пользователя, связанный с учетными данными       |
|        email        |                               String(256)                                |         UNIQUE, NN          | Электронная почта пользователя, уникальная для каждой учетной записи |
|    password_hash    |                               String(256)                                |             NN              |                  Зашифрованный пароль пользователя                   |
| password_encryption | Enum[("PasswordEncryptionTypes")](#перечисление-passwordencryptiontypes) |      DEFAULT(NONE), NN      |                        Тип шифрования пароля                         |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, к которому относятся эти учетные данные.

---

#### [ORM-модель `UserDetails`](users/user_details.py)
**Описание**  

Модель хранит подробности о пользователе.

**Поля**

|       Поле       | Тип |                  Атрибуты                   |                                  Описание                                   |
|:----------------:|:---:|:-------------------------------------------:|:---------------------------------------------------------------------------:|
|     user_id      | int |         FK("users.user_id"), PK, NN         | Идентификатор пользователя в БД. Уникален, ссылается на модель пользователя |
|   description    | str |                      N                      |                        Описание профиля пользователя                        |
| profile_image_id | int | FK("files.file_id", ondelete="SET NULL"), N |      Ссылка на изображение профиля, может быть пустым (не установлено)      |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, к которому относится данный профиль.  
- [**`profile_image`**](#orm-модель-file): указывает на изображение профиля пользователя (если оно установлено).

#### [ORM-модель `UserLoginAttempts`](users/user_login_attempts.py)
**Описание**  

Модель представляет таблицу для хранения логов попыток входа пользователей.

**Поля**

|    Поле    |    Тип     |           Атрибуты            |                        Описание                        |
|:----------:|:----------:|:-----------------------------:|:------------------------------------------------------:|
| attempt_id |    int     |          PK, AI, NN           |         Уникальный идентификатор попытки входа         |
|  user_id   |    int     |    FK("users.user_id"), NN    | Идентификатор пользователя, совершившего попытку входа |
| attempt_at |  datetime  | NN, server_default=func.now() |       Время, когда была совершена попытка входа        |
| is_success |    bool    |              NN               |           Был ли вход успешным? (True/False)           |
| ip_address | String(45) |               N               |   IP-адрес, с которого была совершена попытка входа    |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, который совершил попытку входа.

---
#### [Модуль `profile/`](users/profile)
Модуль `profile` объединяет общие для всех пользователей orm-модели, 
такие, как закладки и персональные списки.

---
##### [Модуль `bookmarks/`](users/profile/bookmarks)
Модуль `bookmarks` объединяет закладки пользователей для книг.

---

###### [ORM-модель `UserBookmark`](users/profile/bookmarks/user_bookmarks.py)
**Описание**  

Модель предназначена для хранения закладок пользователей в книгах.

**Поля**

|      Поле      |                                  Тип                                   |           Атрибуты            |              Описание              |
|:--------------:|:----------------------------------------------------------------------:|:-----------------------------:|:----------------------------------:|
|  bookmark_id   |                                  int                                   |          PK, AI, NN           | Уникальный идентификатор закладки  |
|    user_id     |                                  int                                   |    FK("users.user_id"), NN    |     Идентификатор пользователя     |
|    book_id     |                                  int                                   |    FK("books.book_id"), NN    |        Идентификатор книги         |
|    bookmark    |                                  int                                   |         N, DEFAULT(0)         |       Позиция в тексте книги       |
| book_file_type | Enum[("AllowedBookFileFormats")](#перечисление-allowedbookfileformats) |              NN               | Тип файла книги (EPUB, FB2 и т.д.) |
|   created_at   |                                datetime                                | NN, server_default=func.now() |   Дата и время создания закладки   |

**Связи**

- **`user`**: связь с ORM-моделью [User]. Указывает на пользователя, которому принадлежит закладка.  
- [**`book`**](#orm-модель-book): указывает на книгу, в которой сделана закладка.  
- [**`bookmark_epub`**](#orm-модель-bookmarkepub): связь с моделью [BookmarkEPUB]. Представляет дополнительные данные закладки для EPUB-файлов.  
- [**`bookmark_fb2`**](#orm-модель-bookmarkfb2): представляет дополнительные данные закладки для FB2-файлов.

---

###### [ORM-модель `BookmarkEPUB`](users/profile/bookmarks/bookmark_epub.py)
**Описание**  

Модель представляет закладку пользователя в книге формата `EPUB`.
Используется как дочерняя запись к общей таблице закладок.

**Поля**

|    Поле     |     Тип     |                 Атрибуты                 |                 Описание                 |
|:-----------:|:-----------:|:----------------------------------------:|:----------------------------------------:|
| bookmark_id |     int     | FK("user_bookmarks.bookmark_id"), PK, NN | Ссылка на основную закладку пользователя |
|  location   | String(255) |                    NN                    |        Указатель на место в EPUB         |

**Связи**

- [**`user_bookmark`**](#orm-модель-userbookmark): указывает на основную запись закладки, к которой относится EPUB-закладка.

---

##### [ORM-модель `BookmarkFB2`](users/profile/bookmarks/bookmark_fb2.py)
**Описание**  

Модель представляет закладку пользователя для книг в формате `FB2`.
Используется как дочерняя запись к общей таблице закладок.

**Поля**

|    Поле     | Тип |                           Атрибуты                           |              Описание              |
|:-----------:|:---:|:------------------------------------------------------------:|:----------------------------------:|
| bookmark_id | int | FK("user_bookmarks.bookmark_id", ondelete="CASCADE"), PK, NN | Ссылка на основную запись закладки |
|  position   | int |                              NN                              |   Позиция в тексте формата `FB2`   |

**Связи**

- [**`user_bookmark`**](#orm-модель-userbookmark): указывает на основную запись закладки, к которой относится FB2-версия.

---

#### [Модуль `personal_lists/`](users/profile/personal_lists)
Модуль `personal_lists` объединяет orm-модели для представления персонализированных списков пользователей.

---

##### [ORM-модель `UserPersonalList`](users/profile/personal_lists/user_personal_lists.py)
**Описание**  

Модель описывает персональные списки произведений, создаваемые пользователями.  
При регистрации пользователя автоматически создаются списки по умолчанию, соответствующие его языковым предпочтениям, такие как:  
*Читаю*, *В планах*, *Брошено*, *Прочитано*, *Любимое*.  
Каждый список уникален в пределах одного пользователя по названию.

**Поля**

|       Поле       |                                Тип                                 |           Атрибуты            |                     Описание                      |
|:----------------:|:------------------------------------------------------------------:|:-----------------------------:|:-------------------------------------------------:|
| personal_list_id |                                int                                 |          PK, AI, NN           | Уникальный идентификатор пользовательского списка |
|     user_id      |                                int                                 |    FK("users.user_id"), NN    |     Пользователь, которому принадлежит список     |
|    list_name     |                             String(32)                             |              NN               |           Название персонального списка           |
|    list_type     | Enum[("UserPersonalListType")](#перечисление-userpersonallisttype) |              NN               | Тип списка, определяет возможность редактирования |
|    updated_at    |                              datetime                              | NN, server_default=func.now() |         Дата последнего обновления списка         |
|    created_at    |                              datetime                              | NN, server_default=func.now() |               Дата создания списка                |

**Связи**

- **`user`**: указывает на пользователя, которому принадлежит список.  
- [**`items`**](#orm-модель-userpersonallist): содержит элементы, входящие в данный список пользователя.
---

##### [ORM-модель `UserPersonalListItem`](users/profile/personal_lists/user_personal_list_items.py)
**Описание**  

Модель представляет элемент пользовательского списка, содержащий информацию о книге, 
добавленной пользователем в один из его персональных списков. 
Используется для реализации функционала «добавить книгу в список».

**Поля**

|       Поле       |   Тип    |                      Атрибуты                      |                Описание                |
|:----------------:|:--------:|:--------------------------------------------------:|:--------------------------------------:|
| personal_list_id |   int    | FK("user_personal_lists.personal_list_id"), PK, NN | Идентификатор пользовательского списка |
|     book_id      |   int    |            FK("books.book_id"), PK, NN             |          Идентификатор книги           |
|     added_at     | datetime |              NN, DEFAULT(func.now())               | Дата и время добавления книги в список |

**Связи**

- [**`personal_list`**](#orm-модель-userpersonallist): указывает на пользовательский список, в который добавлена книга.  
- [**`book`**](#orm-модель-book): указывает на книгу, которая добавлена в персональный список пользователя.

---

#### [Модуль `roles/`](users/roles)
Модуль `roles` объединяет расширения дополнительной информации для разных ролей, таких как авторы и издатели.

---
##### [Модуль `author/`](users/roles/author)
Модуль `authors` объединяет orm-модели для авторов книг.

---
###### [ORM-модель `Authors`](users/roles/author/authors.py)
**Описание**  

Модель представляет автора книги. Используется для хранения основной информации об авторах.

**Поля**

|     Поле      |     Тип      |  Атрибуты  |                Описание                |
|:-------------:|:------------:|:----------:|:--------------------------------------:|
|   author_id   |     int      | PK, AI, NN |    Уникальный идентификатор автора     |
|  first_name   | String(255)  |     NN     |               Имя автора               |
|   last_name   | String(255)  |     NN     |             Фамилия автора             |
| contact_email | String(255)  |     NN     |        Электронная почта автора        |
|    website    | String(1025) |     N      | Персональный сайт автора (если указан) |
|   birthday    |   datetime   |     N      |          Дата рождения автора          |
|  nationality  | String(255)  |     N      |         Страна рождения автора         |
|  description  |     str      |     N      | Краткое описание или биография автора  |

**Связи**

- [**`books`**](#orm-модель-bookauthors): указывает на книги, в которых указан этот автор.  
- [**`author_curators`**](#orm-модель-authorcurators): указывает на пользователя, который курирует этого автора.

---

###### [ORM-модель `AuthorCurators`](users/roles/author/author_curators.py)
**Описание**  

Модель представляет связь между пользователями и авторами, которых они курируют.  
Используется для управления доступом пользователей к редактированию или ведению профиля автора.

**Поля**

|       Поле        | Тип |          Атрибуты           |                   Описание                   |
|:-----------------:|:---:|:---------------------------:|:--------------------------------------------:|
| author_curator_id | int |         PK, AI, NN          |   Уникальный идентификатор записи куратора   |
|    account_id     | int |   FK("users.user_id"), NN   |  Пользователь, назначенный куратором автора  |
|     author_id     | int | FK("authors.author_id"), NN | Автор, которого курирует данный пользователь |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, выполняющего роль куратора автора.  
- [**`author`**](#orm-модель-authors): указывает на автора, которого курирует пользователь.

---

###### [ORM-модель `BookAuthors`](users/roles/author/book_authors.py)
**Описание**  

Модель представляет связь между книгой и её автором.

**Поля**

|   Поле    | Тип |            Аттрибуты            |       Описание       |
|:---------:|:---:|:-------------------------------:|:--------------------:|
| author_id | int | FK("authors.author_id"), PK, NN | Идентификатор автора |
|  book_id  | int |   FK("books.book_id"), PK, NN   | Идентификатор книги  |

**Связи**

- [**`author`**](#orm-модель-authors): указывает на автора, связанного с книгой.  
- [**`book`**](#orm-модель-book): указывает на книгу, к которой относится автор.

---

##### [Модуль `publisher/`](users/roles/publisher)
Модуль `publisher` объединяет orm-модели, которые служат для дополнительной информации об издателях.

###### [ORM-модель `Publishers`](users/roles/publisher/publishers.py)
**Описание**  

Модель представляет информацию об издателе книги. Используется для хранения контактных данных, описания,  
даты основания и других сведений об издательстве.

**Поля**

|      Поле      |     Тип      |           Атрибуты            |             Описание              |
|:--------------:|:------------:|:-----------------------------:|:---------------------------------:|
|  publisher_id  |     int      |          PK, AI, NN           | Уникальный идентификатор издателя |
| publisher_name | String(255)  |              NN               |         Название издателя         |
|    website     | String(1025) |               N               |    Сайт издателя (если указан)    |
| contact_email  | String(255)  |              NN               |    Электронная почта издателя     |
| contact_phone  |  String(50)  |              NN               |         Телефон издателя          |
|  founded_year  |   datetime   |              NN               |    Дата основания издательства    |
|  description   |     str      |              NN               |  Текстовое описание издательства  |
|   created_at   |   datetime   | NN, server_default=func.now() |    Дата добавления записи в БД    |

**Связи**

- [**`publisher_curators`**](#orm-модель-publishercurators): позволяет получить кураторов, связанных с издателем.  
- [**`books`**](#orm-модель-bookpublishers): показывает, какие книги связаны с этим издателем.

---

###### [ORM-модель `PublisherCurators`](users/roles/publisher/publisher_curators.py)
**Описание**  

Модель представляет ассоциацию между кураторами и издательствами.

**Поля**

|         Поле         | Тип |             Атрибуты              |                        Описание                         |
|:--------------------:|:---:|:---------------------------------:|:-------------------------------------------------------:|
| publisher_curator_id | int |            PK, AI, NN             |            Уникальный идентификатор куратора            |
|      account_id      | int |      FK("users.user_id"), NN      | Идентификатор пользователя, который является куратором  |
|     publisher_id     | int | FK("publishers.publisher_id"), NN | Идентификатор издательства, к которому привязан куратор |

**Связи**

- [**`user`**](#orm-модель-user): указывает на пользователя, который является куратором.
- [**`publisher`**](#orm-модель-publishers): указывает на издательство, к которому привязан куратор.

---

###### [ORM-модель `BookPublishers`](users/roles/publisher/book_publishers.py)
**Описание**  

Модель представляет связь между книгами и издателями.

**Поля**

|     Поле     | Тип |               Атрибуты                |                           Описание                           |
|:------------:|:---:|:-------------------------------------:|:------------------------------------------------------------:|
| publisher_id | int | FK("publishers.publisher_id"), PK, NN |    Идентификатор издательства, которое опубликовало книгу    |
|   book_id    | int |      FK("books.book_id"), PK, NN      | Идентификатор книги, которая была опубликована издательством |

**Связи**

- [**`book`**](#orm-модель-book): указывает на книгу, опубликованную указанным издательством.
- [**`publisher`**](#orm-модель-publishers): указывает на издательство, которое опубликовало книгу.

---

